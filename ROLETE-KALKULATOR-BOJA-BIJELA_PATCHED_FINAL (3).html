
<!DOCTYPE html>
<html lang="hr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ROLETE-KALKULATOR — Kuća (do 20) — Naša & Kupac (v7_4_fix2)</title>
<style>
  :root { --accent:#0067b8; --muted:#f3f4f6; --text:#111827; }
  * { box-sizing:border-box; }
  body { margin:0; font-family:Segoe UI, Roboto, Arial, sans-serif; background:var(--muted); color:var(--text); }
  header { background:var(--accent); color:white; padding:12px 16px; }
  header h1 { margin:0; font-size:18px; }
  main { max-width:1250px; margin:16px auto; padding:0 12px; display:grid; grid-template-columns: 1fr 360px; grid-template-rows:auto auto; gap:12px; }
  .card { background:#fff; border-radius:12px; padding:12px; box-shadow:0 1px 3px rgba(0,0,0,.08); }
  .card h2 { margin:0 0 8px; font-size:16px; }
  label { display:block; font-weight:600; margin:8px 0 4px; }
  select, input[type=number] { width:100%; padding:8px 10px; border:1px solid #d1d5db; border-radius:8px; font-size:14px; }
  .row { display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
  .btn { background:var(--accent); color:white; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:600; }
  .btn.secondary { background:#374151; }
  .kpi { background:#f9fafb; border:1px solid #e5e7eb; border-radius:12px; padding:10px 12px; }
  .kpi .label { color:#6b7280; font-size:12px; }
  .kpi .value { font-size:20px; font-weight:700; }
  .kpi .sub { color:#6b7280; font-size:12px; font-style:italic; }
  table { width:100%; border-collapse:collapse; }
  th, td { padding:8px; border-bottom:1px solid #e5e7eb; text-align:right; }
  th:first-child, td:first-child { text-align:left; }
  tfoot td { font-weight:700; }
  .note { color:#6b7280; font-size:12px; }
  .qty { width:60px; }
  .small { font-size:12px; color:#6b7280; }
  .settings { display:grid; grid-template-columns:repeat(3, 1fr); gap:8px; }
  #tbl th:nth-child(1), #tbl td:nth-child(1) { width:40px; }
  #tbl th:nth-child(2), #tbl td:nth-child(2) { width:240px; }
  #tbl th:nth-child(3), #tbl td:nth-child(3) { width:170px; }
  #tbl th:nth-child(4), #tbl td:nth-child(4) { width:170px; }
  #tbl th:nth-child(5), #tbl td:nth-child(5) { width:80px; }
</style>
</head>
<body>
<header>
  <h1>IDiS d.o.o. - Kalkulator roleta — Kuća (do 20 kom) — Naša & Kupac (v7_4_fix2)</h1>
</header>
<main>
  <section class="card" style="grid-column:1; grid-row:1;">
    <h2>Postavke dodataka</h2>
    <div class="settings">
      <div><label>Alu šina (€/m po širini)</label><input type="number" id="rate_sina" value="3.72" step="0.01" /></div>
      <div><label>Aretiranje (€/m po visini)</label><input type="number" id="rate_areta" value="2.19" step="0.01" /></div>
      <div><label>Kutija Dekor (€/m po širini)</label><input type="number" id="rate_j1" value="15.93" step="0.01" /></div>
      <div><label>Vodilice (€/m po visini)</label><input type="number" id="rate_vodil" value="9.56" step="0.01" /></div>
      <div><label>Završna lajsna (€/m po širini)</label><input type="number" id="rate_lajsna" value="0.80" step="0.01" /></div>
      <div><label>Alu lamele u boji (€/m²)</label><input type="number" id="rate_lamele" value="2.39" step="0.01" /></div>
    </div>
    <label class="row" style="margin-top:6px;"><input type="checkbox" id="box210" /> Kutija 210 mm u boji (povećaj bazu za +5%)</label>
    <label class="row" style="margin-top:4px;"><input type="checkbox" id="kupacX2OnColor" checked /> Kupac — u boji = 2 × (Naša — u boji)</label>
    <div class="note" style="margin-top:4px;">Ako je uključeno, <b>Kupac — u boji</b> je dvostruka vrijednost <b>Naša — u boji</b>. Inače: Bijela ×2 (uz 1,05 ako je uključeno) + D.</div>
  </section>

  <aside class="card" style="grid-column:2; grid-row:1;">
    <h2>Izračun (označena stavka)</h2>
    <div class="kpi" style="margin-bottom:8px;"><div class="label">Naša — bijela</div><div class="value" id="kpi_nasa_bijela">—</div><div class="sub" id="kpi_nasa_bijela_orig">(originalna bijela: —)</div></div>
    <div class="kpi" style="margin-bottom:8px;"><div class="label">Naša — u boji</div><div class="value" id="kpi_nasa_boja">—</div></div>
    <div class="kpi" style="margin-bottom:8px;"><div class="label">Kupac — bijela (×100%)</div><div class="value" id="kpi_kupac_bijela">—</div></div>
    <div class="kpi"><div class="label">Kupac — u boji</div><div class="value" id="kpi_kupac_boja">—</div></div>
  </aside>

  <section class="card" style="grid-column:1 / -1; grid-row:2;">
    <h2>Unos roleta (do 20 kom)</h2>
    <div class="row" style="margin-bottom:8px;">
      <button class="btn" id="add_row">Dodaj roletu</button>
      <button class="btn secondary" id="del_row">Ukloni zadnju</button>
      <button class="btn" id="calc_all">Izračunaj sve</button>
    </div>
    <div class="row" style="margin-bottom:8px; gap:8px; align-items:center; justify-content:flex-end">
      <label for="pct_plus" style="font-weight:600">Uvećanje (%)</label>
      <input id="pct_plus" type="number" step="0.1" value="30" style="max-width:120px"/>
    </div>
    <table id="tbl">
      <thead>
        <tr>
          <th style="text-align:center">#</th>
          <th>Cjenik</th>
          <th>Širina (mm)</th>
          <th>Visina (mm)</th>
          <th>Količina</th>
          <th>Naša — bijela</th>
          <th>Naša — u boji</th>
          <th>Kupac — bijela</th>
          <th>Kupac — u boji</th>
          <th>Naša — bijela (+%)</th>
          <th>Naša — u boji (+%)</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <td colspan=5 style="text-align:right"><b>Zbroj (Naša)</b></td>
          <td id="sum_nasa_bijela">—</td>
          <td id="sum_nasa_boja">—</td>
          <td class="small">(informativno)</td>
          <td class="small">(informativno)</td>
          <td id="sum_nasa_bijela_plus">—</td>
          <td id="sum_nasa_boja_plus">—</td>
        </tr>
        <tr>
          <td colspan=5 style="text-align:right"><b>Zbroj (Kupac)</b></td>
          <td class="small">(informativno)</td>
          <td class="small">(informativno)</td>
          <td id="sum_kupac_bijela">—</td>
          <td id="sum_kupac_boja">—</td>
          <td class="small">(informativno)</td>
          <td class="small">(informativno)</td>
        </tr>
      </tfoot>
    </table>
    <div class="note">Klik na red osvježava panel iznad.</div>
  </section>
</main>
<script>
  const BOOKS = {"rol-1-190.xlsx": {"label": "1-dijelna ALU, kutija 210\u00d7190", "widths": [600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600], "heights": [600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 2100, 2200, 2300, 2400], "prices": {"600": {"600": 46.68908769890504, "700": 49.7188064257615, "800": 53.439749869560025, "900": 56.89587345427036, "1000": 60.44625495492735, "1100": 63.902378539637695, "1200": 67.45276004029466, "1300": 71.07944556814654, "1400": 74.71510804037428, "1500": 78.08595065351386, "1600": 81.72161312574161}, "700": {"600": 48.260052964682465, "700": 51.46931057905635, "800": 55.54035485351384, "900": 59.09073635417083, "1000": 62.81167979796934, "1100": 66.62688115771451, "1200": 70.26254362994227, "1300": 74.06876804531157, "1400": 77.78971148911009, "1500": 81.60491284885529, "1600": 85.24057532108303}, "800": {"600": 50.52224294740195, "700": 53.99632042086402, "800": 57.973106779374895, "900": 61.78830813912007, "1000": 65.77407144200677, "1100": 69.67455377332273, "1200": 73.39549721712127, "1300": 77.46654149157875, "1400": 79.6569159192913, "1500": 85.17324823826401, "1600": 89.07373056957995}, "900": {"600": 52.60489404260403, "700": 56.343791375154304, "800": 60.585397592753345, "900": 64.75069978315749, "1000": 68.91600197356162, "1100": 73.08130416396577, "1200": 77.06706746685249, "1300": 81.40293160039818, "1400": 85.6535147623731, "1500": 89.63927806525982, "1600": 93.80458025566394}, "1000": {"600": 54.60226416623533, "700": 58.60598135787379, "800": 63.02712646299025, "900": 67.45724851248258, "1000": 71.62255070288674, "1100": 76.05267275237907, "1200": 80.21797494278321, "1300": 84.90393990698787, "1400": 89.15452306896279, "1500": 93.49936414688436, "1600": 97.74994730885929}, "1100": {"600": 56.86445414895481, "700": 61.132991199681484, "800": 65.63941727636872, "900": 70.24907821337847, "1000": 74.58494234692418, "1100": 79.2798842555047, "1200": 83.71000630499702, "1300": 88.3959712692017, "1400": 92.9113742902648, "1500": 97.4267773113279, "1600": 101.94218033239099}, "1200": {"600": 58.94710524415688, "700": 63.48046215397175, "800": 68.07216920222976, "900": 73.03193096989848, "1000": 77.81215385004978, "1100": 82.50709575863033, "1200": 87.28731863878161, "1300": 92.05856457455707, "1400": 96.83878745470835, "1500": 101.5337293632889, "1600": 106.3139522434402}, "1300": {"600": 60.94447536778819, "700": 65.65737116512045, "800": 70.51389807246667, "900": 75.4542097939877, "1000": 80.51870257937487, "1100": 85.47846434704361, "1200": 90.25868722719491, "1300": 95.47429190957598, "1400": 100.43405367724469, "1500": 105.21427655739599, "1600": 110.25931929663551}, "1400": {"600": 63.02712646299025, "700": 68.09012309098149, "800": 73.12618888584514, "900": 78.53030940011946, "1000": 83.48109422341231, "1100": 88.70567585016926, "1200": 93.75071858940872, "1300": 99.23114313087798, "1400": 104.27618587011747, "1500": 109.32122860935698, "1600": 114.63109120768466}, "1500": {"600": 65.20403547413898, "700": 70.44657098964764, "800": 75.3883788685646, "900": 81.05731924192715, "1000": 86.36718184025484, "1100": 91.67704443858253, "1200": 96.98690703691021, "1300": 102.46733157837947, "1400": 107.77719417670714, "1500": 113.08705677503487, "1600": 118.39691937336259}, "1600": {"600": 67.28668656934106, "700": 72.7940419439379, "800": 78.08595065351386, "900": 83.82072195229944, "1000": 89.32957348429228, "1100": 94.90425594170816, "1200": 100.47893839912403, "1300": 106.22418279968147, "1400": 111.79886525709739, "1500": 117.19400882699584, "1600": 122.76869128441173}, "1700": {"600": 69.36933766454311, "700": 73.34612402305397, "800": 80.6982414668923, "900": 86.69783262476611, "1000": 92.2919651283297, "1100": 98.13146744483379, "1200": 103.88568878976707, "1300": 109.80149513346609, "1400": 115.64099744997014, "1500": 121.30096087895683, "1600": 127.1404631954609}, "1800": {"600": 71.54624667569183, "700": 77.49796079689429, "800": 82.96043144961182, "900": 89.33855042866813, "1000": 94.99851385765481, "1100": 101.10283603324709, "1200": 106.94233834975118, "1300": 113.21722246848496, "1400": 119.14200575655985, "1500": 124.98150807306392, "1600": 131.0005492770854}, "1900": {"600": 73.71417874246468, "700": 79.93071272275533, "800": 85.57272226299027, "900": 92.21566110113478, "1000": 98.2257253607804, "1100": 104.3300475363727, "1200": 110.51965068353576, "1300": 116.79453480226957, "1400": 122.98413794943265, "1500": 129.26799901254233, "1600": 135.45760215970537}, "2000": {"600": 75.79682983766675, "700": 82.2781836770456, "800": 88.1850130763687, "900": 95.09277177360146, "1000": 101.18811700481785, "1100": 107.55725903949835, "1200": 113.92640107417881, "1300": 120.55138602357161, "1400": 127.00580902982286, "1500": 133.37495106450334, "1600": 139.64983518323712}, "2100": {"600": 77.46205301939082, "700": 84.20822671785785, "800": 90.20033708875174, "900": 97.37291564507267, "1000": 103.4682608762891, "1100": 110.10222277005778, "1200": 116.73618466382644, "1300": 123.54070850073663, "1400": 129.9951315069879, "1500": 136.62909340075655, "1600": 143.0835164070078}, "2200": {"600": 79.20358022830979, "700": 86.21457378586504, "800": 92.20668415675895, "900": 99.64408257216805, "1000": 106.18378654999007, "1100": 112.90302941532947, "1200": 119.80181116818633, "1300": 126.77689694823813, "1400": 133.49613981357757, "1500": 140.21538267891702, "1600": 147.11416443177384}, "2300": {"600": 80.68926452251644, "700": 87.96507793915988, "800": 94.22200816914194, "900": 101.92422644363928, "1000": 108.54921139303207, "1100": 115.62753203340635, "1200": 122.61159475783397, "1300": 129.76621942540316, "1400": 136.66500117826004, "1500": 143.6490639026877, "1600": 150.63312662711533}, "2400": {"600": 82.43079173143542, "700": 89.88614403559629, "800": 96.40789412466653, "900": 104.37493225825203, "1000": 111.08519817921561, "1100": 118.42833867867812, "1200": 125.4976823746765, "1300": 132.9171269013339, "1400": 140.08072851327896, "1500": 147.32961109679482, "1600": 154.3989547927932}}}, "rol-1-210.xlsx": {"label": "1-dijelna ALU + rolo komarnik, kutija 210\u00d7210", "widths": [600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600], "heights": [600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 2100, 2200, 2300, 2400], "prices": {"600": {"600": 73.61992082651801, "700": 78.08595065351386, "800": 83.78182186000402, "900": 88.49471765733625, "1000": 92.94279359558034, "1100": 98.01476716794743, "1200": 103.00145976874381, "1300": 108.06445639673505, "1400": 113.31596885661956, "1500": 118.12312256989848, "1600": 123.37463502978301}, "700": {"600": 75.37042497981287, "700": 80.37507146936095, "800": 86.06196573147525, "900": 91.0486583322716, "1000": 95.84683510117459, "1100": 101.09834756105913, "1200": 106.52939890846108, "1300": 111.7719344239698, "1400": 116.74965008039023, "1500": 122.36024031530961, "1600": 127.25267500015927}, "800": {"600": 78.17123162508463, "700": 83.26115908620349, "800": 88.8537954323711, "900": 93.92576900473826, "1000": 99.16830452024688, "1100": 104.5050979517022, "1200": 110.02143027067491, "1300": 115.34924675775433, "1400": 119.15547117312363, "1500": 126.28765347975316, "1600": 131.44490802369103}, "900": {"600": 80.61296049532156, "700": 86.14724670304601, "800": 91.64562513326696, "900": 97.06769953629306, "1000": 102.66931282683655, "1100": 108.45046500489748, "1200": 113.87253940792355, "1300": 119.82425352912605, "1400": 125.51114779124033, "1500": 131.29229996930124, "1600": 136.7143743723273}, "1000": {"600": 82.78986950647027, "700": 88.58897557328292, "800": 94.44643177853874, "900": 99.95378715313558, "1000": 105.73493933119653, "1100": 111.78091136834561, "1200": 117.56206354640655, "1300": 123.68433961075058, "1400": 129.37123387286488, "1500": 135.5114638259606, "1600": 141.01881920055746}, "1100": {"600": 85.59067615174199, "700": 91.47506319012545, "800": 97.59733925446946, "900": 102.92515574154889, "1000": 109.05640875026877, "1100": 115.54673953402354, "1200": 121.23363379613778, "1300": 127.5354487479992, "1400": 133.66670175671914, "1500": 139.79795476543902, "1600": 145.74966888664147}, "1200": {"600": 88.03240502197893, "700": 94.36115080696797, "800": 100.38916895536534, "900": 106.24662516062114, "1000": 112.64269802842922, "1100": 119.13302881218397, "1200": 125.1700239049572, "1300": 131.73665871590686, "1400": 137.95319269619753, "1500": 144.44352347995223, "1600": 150.4805185727255}, "1300": {"600": 90.38885292064504, "700": 96.89713759315154, "800": 103.1899756006371, "900": 109.02798175974524, "1000": 115.88786342030659, "1100": 122.4634751756321, "1200": 128.68000915592276, "1300": 135.5114638259606, "1400": 142.08707558128611, "1500": 148.48314844909416, "1600": 154.78496340095563}, "1400": {"600": 93.01012067839937, "700": 99.68896729404742, "800": 106.34088307656779, "900": 112.64269802842922, "1000": 119.20933283937885, "1100": 126.22930334131001, "1200": 132.53111829317143, "1300": 139.8069317098149, "1400": 146.28828554919372, "1500": 153.12871716360743, "1600": 159.51581308703965}, "1500": {"600": 95.54610746458292, "700": 102.58403185526579, "800": 109.14168972183955, "900": 116.60601897037625, "1000": 123.71127044387818, "1100": 130.0983663673104, "1200": 137.2036178408123, "1300": 144.29989236993833, "1400": 151.22560495592276, "1500": 158.33085642942467, "1600": 164.89749124037434}, "1600": {"600": 98.16737522233724, "700": 105.2905805845909, "800": 112.37787816934102, "900": 119.72849945578345, "1000": 127.03273986295045, "1100": 133.68465564547083, "1200": 141.05472697806096, "1300": 148.41582136627514, "1400": 155.78589269886524, "1500": 162.7968862564205, "1600": 169.98741870149317}, "1700": {"600": 100.42956520505676, "700": 106.20174043874181, "800": 115.16970787023693, "900": 122.96468790328495, "1000": 130.71328705705756, "1100": 137.27094492363133, "1200": 144.82055514373883, "1300": 152.35221147509463, "1400": 159.9871026667729, "1500": 167.08337719589886, "1600": 174.5387295000598}, "1800": {"600": 104.04278531634485, "700": 112.14896608775636, "800": 119.40682561564806, "900": 127.22125569484372, "1000": 134.856146886522, "1100": 142.7558579372885, "1200": 150.5702880164842, "1300": 158.82009989790964, "1400": 166.18119428612385, "1500": 173.9956243653196, "1600": 181.98959333203268}, "1900": {"600": 106.74933404566997, "700": 114.94079578865224, "800": 122.55773309157878, "900": 130.45744414234525, "1000": 138.44243616468248, "1100": 146.52168610296636, "1200": 154.50667812530364, "1300": 162.75649000672905, "1400": 170.56194314154894, "1500": 178.6411930798328, "1600": 186.8057239896875}, "2000": {"600": 109.19106291590684, "700": 117.64734451797733, "800": 125.34956279247464, "900": 133.69363258984674, "1000": 141.76390558375473, "1100": 150.10797538112686, "1200": 158.2725062909815, "1300": 166.69288011554855, "1400": 174.94269199697396, "1500": 183.1072229068286, "1600": 191.35703478825403}, "2100": {"600": 111.21536387266578, "700": 119.93646533382443, "800": 127.5444256923751, "900": 136.5123931238702, "1000": 144.40312723026082, "1100": 153.01201688672117, "1200": 161.44136765566398, "1300": 169.861741480231, "1400": 178.29109224917386, "1500": 186.8999819056341, "1600": 195.1497937870595}, "2200": {"600": 113.31596885661956, "700": 122.48142906438389, "800": 129.7303116478997, "900": 139.14263782600045, "1000": 147.47773067899664, "1100": 156.17190130702772, "1200": 165.04561082257618, "1300": 173.4570077027673, "1400": 182.1511783307984, "1500": 190.66581007131202, "1600": 199.5395195868605}, "2300": {"600": 116.41750313848296, "700": 125.84778320533547, "800": 133.5410245354569, "900": 143.03863168512848, "1000": 151.81808328473028, "1100": 160.69179280027873, "1200": 169.8303221749154, "1300": 178.78033571765877, "1400": 187.4745063456899, "1500": 196.4334968328091, "1600": 205.21294843241094}, "2400": {"600": 118.69764700995425, "700": 128.30746596432417, "800": 136.08598826601633, "900": 146.0279541622935, "1000": 155.0722256209835, "1100": 164.03121610810277, "1200": 173.07548756679282, "1300": 182.46985985614182, "1400": 191.78792811829587, "1500": 200.65266068946852, "1600": 209.5173932606411}}}, "rol-2-190.xlsx": {"label": "2-dijelna ALU, kutija 210\u00d7190", "widths": [1400, 1500, 1600, 1700, 1800, 1900, 2000, 2100, 2200, 2300, 2400, 2500, 2600, 2700, 2800, 2900, 3000], "heights": [600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 2100, 2200, 2300, 2400], "prices": {"600": {"1400": 85.80163434457498, "1500": 88.83135307143141, "1600": 92.80813942994227, "1700": 96.09370107151106, "1800": 99.68672305795343, "1900": 103.15406782313362, "2000": 106.65732036581724, "2100": 110.16057290850094, "2200": 113.66382545118456, "2300": 117.16707799386822, "2400": 120.67033053655187, "2500": 124.17358307923557, "2600": 127.67683562191921, "2700": 131.18008816460286, "2800": 134.6833407072865, "2900": 138.18659324997014, "3000": 141.6898457926538}, "700": {"1400": 89.30264265116469, "1500": 92.51190026553856, "1600": 96.57396759562016, "1700": 100.06749511522992, "1800": 103.8826964749751, "1900": 107.48245116969912, "2000": 111.15402141943034, "2100": 114.8255916691616, "2200": 118.49716191889283, "2300": 122.16873216862408, "2400": 125.8403024183553, "2500": 129.51187266808654, "2600": 133.1834429178178, "2700": 136.855013167549, "2800": 140.52658341728025, "2900": 144.1981536670115, "3000": 147.86972391674269}, "800": {"1400": 93.99758455974518, "1500": 97.47166203320727, "1600": 101.79854922237708, "1700": 105.55689660107504, "1800": 109.45737893239074, "1900": 113.35786126370667, "2000": 117.25834359502264, "2100": 121.15882592633861, "2200": 125.05930825765452, "2300": 128.95979058897046, "2400": 132.86027292028643, "2500": 136.76075525160238, "2600": 140.66123758291832, "2700": 144.5617199142343, "2800": 148.4622022455502, "2900": 152.36268457686617, "3000": 156.26316690818211}, "900": {"1400": 98.69252646832575, "1500": 102.43142380087598, "1600": 107.02313084913398, "1700": 110.8667591994025, "1800": 115.03206138980664, "1900": 119.14350191395555, "2000": 123.25494243810445, "2100": 127.36638296225343, "2200": 131.47782348640231, "2300": 135.5892640105512, "2400": 139.70070453470015, "2500": 143.81214505884904, "2600": 147.923585582998, "2700": 152.0350261071469, "2800": 156.1464666312958, "2900": 160.25790715544468, "3000": 164.3693476795936}, "1000": {"1400": 103.22588337814058, "1500": 107.05006168226163, "1600": 111.72704970209038, "1700": 116.0150367989645, "1800": 120.26561996093942, "1900": 124.57006478916956, "2000": 128.87450961739972, "2100": 133.17895444562984, "2200": 137.48339927386002, "2300": 141.78784410209013, "2400": 146.09228893032025, "2500": 150.39673375855043, "2600": 154.70117858678051, "2700": 159.00562341501075, "2800": 163.31006824324086, "2900": 167.61451307147095, "3000": 171.9189578997011}, "1100": {"1400": 107.9208252867211, "1500": 111.92454247835958, "1600": 116.83044257977305, "1700": 121.23662611093003, "1800": 125.6555269799525, "1900": 130.16240190385855, "2000": 134.6477321612625, "2100": 139.13306241866644, "2200": 143.61839267607036, "2300": 148.10372293347433, "2400": 152.58905319087825, "2500": 157.07438344828222, "2600": 161.55971370568614, "2700": 166.0450439630901, "2800": 170.53037422049402, "2900": 175.01570447789797, "3000": 179.50103473530186}, "1200": {"1400": 112.61576719530161, "1500": 116.96958521759908, "1600": 121.98320865152303, "1700": 126.66468514353974, "1800": 131.25863642789173, "1900": 135.9926280445073, "2000": 140.69071188361937, "2100": 145.38879572273143, "2200": 150.08687956184355, "2300": 154.78496340095563, "2400": 159.48304724006775, "2500": 164.1811310791798, "2600": 168.87921491829186, "2700": 173.577298757404, "2800": 178.27538259651607, "2900": 182.97346643562818, "3000": 187.6715502747402}, "1300": {"1400": 116.96958521759908, "1500": 121.50294212741392, "1600": 126.70956986541908, "1700": 131.58105834672483, "1800": 136.3074195606209, "1900": 141.22588738416061, "2000": 146.09408431919545, "2100": 150.9622812542303, "2200": 155.83047818926516, "2300": 160.69867512429997, "2400": 165.56687205933486, "2500": 170.43506899436963, "2600": 175.3032659294045, "2700": 180.17146286443932, "2800": 185.03965979947415, "2900": 189.907856734509, "3000": 194.77605366954384}, "1400": {"1400": 121.66452712617959, "1500": 126.46270389508263, "1600": 131.86233593716906, "1700": 136.98069038881118, "1800": 141.88210201803676, "1900": 147.027686534286, "2000": 152.108637051029, "2100": 157.189587567772, "2200": 162.27053808451495, "2300": 167.35148860125798, "2400": 172.4324391180009, "2500": 177.51338963474393, "2600": 182.59434015148693, "2700": 187.6752906682299, "2800": 192.7562411849729, "2900": 197.83719170171588, "3000": 202.9181422184589}, "1500": {"1400": 126.19788403599445, "1500": 131.08134177646826, "1600": 136.67397812263587, "1700": 142.03919854461452, "1800": 147.11566058916955, "1900": 152.48836179812835, "2000": 157.7820658965795, "2100": 163.0757699950306, "2200": 168.36947409348178, "2300": 173.66317819193287, "2400": 178.95688229038402, "2500": 184.25058638883507, "2600": 189.54429048728616, "2700": 194.8379945857374, "2800": 200.13169868418848, "2900": 205.42540278263962, "3000": 210.71910688109074}, "1600": {"1400": 130.89282594457495, "1500": 135.95582257256623, "1600": 141.74146322281507, "1700": 147.2966956340835, "1800": 152.50556760818264, "1900": 158.06274502406563, "2000": 163.5265622184395, "2100": 168.99037941281335, "2200": 174.45419660718724, "2300": 179.91801380156113, "2400": 185.381830995935, "2500": 190.8456481903089, "2600": 196.30946538468274, "2700": 201.77328257905663, "2800": 207.23709977343057, "2900": 212.70091696780443, "3000": 218.1647341621783}, "1700": {"1400": 135.5877678531555, "1500": 141.00086531180574, "1600": 146.89422929456504, "1700": 152.72475466669326, "1800": 158.10867705612182, "1900": 163.89297116471434, "2000": 169.56954194079634, "2100": 175.24611271687843, "2200": 180.9226834929604, "2300": 186.5992542690424, "2400": 192.27582504512444, "2500": 197.9523958212065, "2600": 203.62896659728852, "2700": 209.30553737337053, "2800": 214.9821081494525, "2900": 220.65867892553462, "3000": 226.33524970161662}, "1800": {"1400": 139.85630490388215, "1500": 145.53422222162058, "1600": 151.70587148003187, "1700": 157.8116898130199, "1800": 163.41330310356335, "1900": 169.46735439065077, "2000": 175.39931923422634, "2100": 181.33128407780188, "2200": 187.26324892137745, "2300": 193.19521376495297, "2400": 199.12717860852857, "2500": 205.0591434521041, "2600": 210.99110829567962, "2700": 216.92307313925514, "2800": 222.85503798283074, "2900": 228.78700282640625, "3000": 234.71896766998185}, "1900": {"1400": 144.6365277840335, "1500": 150.4939839892893, "1600": 156.85863755178184, "1700": 163.15446787405963, "1800": 168.8884910941472, "1900": 175.1270185881588, "2000": 181.22909652765708, "2100": 187.33117446715534, "2200": 193.4332524066537, "2300": 199.535330346152, "2400": 205.63740828565034, "2500": 211.73948622514862, "2600": 217.84156416464688, "2700": 223.94364210414525, "2800": 230.04572004364357, "2900": 236.14779798314186, "3000": 242.24987592264014}, "2000": {"1400": 149.5110085801314, "1500": 155.453745756958, "1600": 162.01140362353183, "1700": 168.55409991614607, "1800": 174.46317355156307, "1900": 180.92881773828424, "2000": 187.2436492594907, "2100": 193.55848078069707, "2200": 199.87331230190358, "2300": 206.18814382311004, "2400": 212.5029753443165, "2500": 218.8178068655229, "2600": 225.13263838672938, "2700": 231.44746990793584, "2800": 237.76230142914224, "2900": 244.07713295034867, "3000": 250.3919644715552}, "2100": {"1400": 152.92673591515032, "1500": 159.1342929510651, "1600": 165.88495512172014, "1700": 172.67451738467082, "1800": 178.75864143541742, "1900": 185.451402314848, "2000": 191.9789874177626, "2100": 198.50657252067717, "2200": 205.0341576235918, "2300": 211.56174272650634, "2400": 218.08932782942097, "2500": 224.61691293233554, "2600": 231.1444980352502, "2700": 237.67208313816477, "2800": 244.19966824107934, "2900": 250.72725334399394, "3000": 257.25483844690854}, "2200": {"1400": 156.8541490795939, "1500": 163.32652597459688, "1600": 170.18491147776237, "1700": 177.19291272052533, "1800": 183.40944670081603, "1900": 190.28668378717077, "2000": 196.98438198600812, "2100": 203.68208018484546, "2200": 210.3797783836828, "2300": 217.07747658252015, "2400": 223.77517478135755, "2500": 230.47287298019484, "2600": 237.17057117903224, "2700": 243.86826937786958, "2800": 250.56596757670695, "2900": 257.2636657755442, "3000": 263.96136397438164}, "2300": {"1400": 160.35515738618355, "1500": 167.00707316870398, "1600": 174.05846297595065, "1700": 181.25647620800348, "1800": 187.6054201178383, "1900": 194.66713341111716, "2000": 201.53494470587728, "2100": 208.4027560006374, "2200": 215.27056729539746, "2300": 222.1383785901576, "2400": 229.00618988491766, "2500": 235.8740011796778, "2600": 242.74181247443795, "2700": 249.609623769198, "2800": 256.4774350639581, "2900": 263.3452463587182, "3000": 270.21305765347836}, "2400": {"1400": 164.19728957905636, "1500": 171.11402522066493, "1600": 178.35841933199285, "1700": 185.80329853438218, "1800": 192.32729285954645, "1900": 199.61612284553485, "2000": 206.69668772200316, "2100": 213.77725259847134, "2200": 220.8578174749396, "2300": 227.93838235140788, "2400": 235.01894722787608, "2500": 242.09951210434434, "2600": 249.18007698081257, "2700": 256.2606418572808, "2800": 263.3412067337491, "2900": 270.4217716102173, "3000": 277.50233648668564}}}, "rol-2-210.xlsx": {"label": "2-dijelna ALU + rolo komarnik (oba pla\u0161ta), 210\u00d7210", "widths": [1400, 1500, 1600, 1700, 1800, 1900, 2000, 2100, 2200, 2300, 2400, 2500, 2600, 2700, 2800, 2900, 3000], "heights": [600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 2100, 2200, 2300, 2400], "prices": {"600": {"1400": 142.53592280007965, "1500": 147.36103040211032, "1600": 153.4922834108302, "1700": 158.21415615253835, "1800": 162.88441146408522, "1900": 167.4289895543699, "2000": 171.65039764712327, "2100": 176.58996128994627, "2200": 181.88860270780413, "2300": 186.82816635062716, "2400": 191.76772999345013, "2500": 196.70729363627316, "2600": 201.64685727909625, "2700": 206.9454986969541, "2800": 211.88506233977702, "2900": 216.82462598260008, "3000": 221.76418962542306}, "700": {"1400": 147.11416443177384, "1500": 151.7597331462871, "1600": 157.61718935154292, "1700": 162.54702797129207, "1800": 167.79854043117652, "1900": 172.47552845100512, "2000": 177.22433202584085, "2100": 182.3322133757115, "2200": 187.44009472558207, "2300": 192.54797607545268, "2400": 198.37401297539296, "2500": 203.4818943252635, "2600": 208.58977567513415, "2700": 213.69765702500476, "2800": 218.4464605998404, "2900": 223.9134197247459, "3000": 229.38037884965138}, "800": {"1400": 152.52726189042406, "1500": 157.79672823906034, "1600": 163.55992652836957, "1700": 168.75458500720683, "1800": 173.73230066362703, "1900": 179.0690940950824, "2000": 184.04680975150285, "2100": 189.38360318295815, "2200": 194.72039661441343, "2300": 200.41626782090358, "2400": 206.11213902739374, "2500": 211.44893245884904, "2600": 216.42664811526947, "2700": 222.1225193217597, "2800": 227.45931275321502, "2900": 233.15518395970508, "3000": 238.4919773911604}, "900": {"1400": 158.29943712410912, "1500": 163.47464555679878, "1600": 169.14358593016124, "1700": 174.4235253805692, "1800": 179.66606089607785, "1900": 185.57289029540092, "2000": 190.7615641446544, "2100": 196.30931576894258, "2200": 202.21614516826574, "2300": 207.76389679255396, "2400": 213.3116484168423, "2500": 219.21847781616543, "2600": 224.76622944045363, "2700": 230.31398106474197, "2800": 235.86173268903025, "2900": 241.76856208835335, "3000": 247.67539148767648}, "1000": {"1400": 163.19187180895884, "1500": 168.4523612132192, "1600": 174.5656603331874, "1700": 179.930880755166, "1800": 185.25869724224546, "1900": 191.35853094564982, "2000": 197.09928687401924, "2100": 203.1991205774236, "2200": 208.93987650579314, "2300": 214.68063243416265, "2400": 220.78046613756695, "2500": 226.52122206593643, "2600": 232.26197799430602, "2700": 238.00273392267545, "2800": 243.74348985104496, "2900": 249.84332355444928, "3000": 255.9431572578536}, "1100": {"1400": 168.604969267609, "1500": 174.4040753344217, "1600": 180.74628653597452, "1700": 185.51154784216632, "1800": 191.00768203629337, "1900": 197.3099458353736, "2000": 203.59066496795177, "2100": 209.8713841005299, "2200": 216.15210323310805, "2300": 221.71466681561648, "2400": 227.63630817315982, "2500": 233.917027305738, "2600": 239.8386686632812, "2700": 246.11938779585935, "2800": 252.04102915340266, "2900": 258.32174828598085, "3000": 264.24338964352415}, "1200": {"1400": 174.3771445012941, "1500": 180.16727362373086, "1600": 186.6172081577942, "1700": 192.01684019988062, "1800": 197.68802480933718, "1900": 203.858327526092, "2000": 210.35180024037834, "2100": 216.84527295466458, "2200": 223.3387456689508, "2300": 229.47314060820233, "2400": 235.2484577724189, "2500": 241.7419304867052, "2600": 248.2354032009915, "2700": 254.36979814024292, "2800": 260.5041930794944, "2900": 266.9976657937806, "3000": 273.4911385080669}, "1300": {"1400": 179.44911807366123, "1500": 185.41878608361543, "1600": 192.06172492175995, "1700": 198.0104467281702, "1800": 203.4549634921359, "1900": 210.16882019084986, "2000": 216.8324060010589, "2100": 223.49599181126786, "2200": 229.80049984644208, "2300": 236.46408565665112, "2400": 242.40951591679053, "2500": 248.71402395196475, "2600": 255.37760976217373, "2700": 262.4002733474177, "2800": 268.34570360755697, "2900": 274.6502116427312, "3000": 281.3137974529402}, "1400": {"1400": 184.86221553231144, "1500": 191.45578117638865, "1600": 198.29172431861443, "1700": 204.12823432032624, "1800": 210.10687927465634, "1900": 217.04785266607976, "2000": 223.56511428296213, "2100": 230.80053144991416, "2200": 237.31779306679647, "2300": 243.83505468367886, "2400": 249.99323852552632, "2500": 257.22865569247836, "2600": 263.7459173093607, "2700": 270.2631789262431, "2800": 276.7804405431255, "2900": 283.6567799350426, "3000": 290.5331193269597}, "1500": {"1400": 190.4728057672308, "1500": 197.15165238287878, "1600": 204.18059982918578, "1700": 211.7002869013735, "1800": 218.2130600460679, "1900": 225.3811501302008, "2000": 232.47024310382616, "2100": 238.8411805273818, "2200": 245.2121179509374, "2300": 252.30121092456278, "2400": 259.3903038981881, "2500": 266.4793968718134, "2600": 273.20941207040397, "2700": 280.29850504402924, "2800": 287.02852024261966, "2900": 294.11761321624505, "3000": 301.2067061898704}, "1600": {"1400": 195.88590322588095, "1500": 202.74428872904642, "1600": 210.32531825446944, "1700": 218.03501731594693, "1800": 224.3211226151506, "1900": 231.6736889062077, "2000": 238.93289497575586, "2100": 245.47394549523426, "2200": 252.0149960147127, "2300": 259.2742020842607, "2400": 266.5334081538088, "2500": 273.7926142233569, "2600": 280.69274251787016, "2700": 287.9519485874182, "2800": 295.2111546569663, "2900": 302.4703607265144, "3000": 309.3704890210277}, "1700": {"1400": 201.29900068453114, "1500": 208.5074870183556, "1600": 215.83716210125428, "1700": 224.18123189862638, "1800": 230.64238761315949, "1900": 238.58114837196106, "2000": 246.41218579825212, "2100": 252.44783434936892, "2200": 259.2016384505555, "2300": 266.6735981018117, "2400": 274.1455577530679, "2500": 281.6175174043242, "2600": 288.73039928054556, "2700": 296.20235893180177, "2800": 303.67431858305804, "2900": 310.7872004592794, "3000": 317.9000823355007}, "1800": {"1400": 209.15831548560624, "1500": 216.63162167851885, "1600": 224.59865981210436, "1700": 231.78171147019685, "1800": 239.17871363591453, "1900": 246.66907602314134, "2000": 255.11458529196076, "2100": 262.8419390107104, "2200": 270.56929272946024, "2300": 278.6557242232449, "2400": 286.38307794199466, "2500": 294.1104316607443, "2600": 302.1968631545289, "2700": 309.56513909824383, "2800": 316.93341504195877, "2900": 324.6607687607084, "3000": 332.74720025449307}, "1900": {"1400": 214.65669391582722, "1500": 222.66861677129208, "1600": 230.8286592089588, "1700": 238.2017228563412, "1800": 245.37205717656812, "1900": 253.04689577071906, "2000": 261.66251813546114, "2100": 269.9190627251686, "2200": 277.8165295398411, "2300": 285.7139963545136, "2400": 293.6114631691861, "2500": 302.586163308963, "2600": 309.7654745735659, "2700": 317.66294138823844, "2800": 325.20133042787614, "2900": 333.0987972425487, "3000": 340.99626405722114}, "2000": {"1400": 220.24933026199486, "1500": 228.34653408903043, "1600": 236.34050305574365, "1700": 244.31951044849725, "1800": 251.6648951840537, "1900": 259.5668504709142, "2000": 268.3952264173644, "2100": 276.86452458877994, "2200": 284.9747449851606, "2300": 293.0849653815413, "2400": 301.19518577792195, "2500": 310.02356172437214, "2600": 317.41562657068323, "2700": 325.88492474209875, "2800": 333.6360673634445, "2900": 341.7462877598251, "3000": 349.8565081562058}, "2100": {"1400": 224.38321314708344, "1500": 232.7452368332073, "1600": 240.57313232896684, "1700": 249.15808346709167, "1800": 257.03759639301245, "1900": 265.5257461476172, "2000": 273.8487201257061, "2100": 282.5307718788297, "2200": 290.8537458569184, "2300": 299.5357976100421, "2400": 307.49969381309614, "2500": 316.1817455662198, "2600": 323.7865639942388, "2700": 332.82769352239734, "2800": 340.79158972545116, "2900": 349.83271925360975, "3000": 357.79661545666374}, "2200": {"1400": 229.3878596366316, "1500": 237.65562540680867, "1600": 245.23216646004389, "1700": 254.39463435301587, "1800": 262.40655720848076, "1900": 271.0791831700097, "2000": 279.5722702440213, "2100": 288.0653573180328, "2200": 296.9175221670792, "2300": 306.1287647911604, "2400": 314.26277409013716, "2500": 322.75586116414877, "2600": 330.53079268809057, "2700": 339.3829575371369, "2800": 347.8760446111485, "2900": 357.0872872352298, "3000": 364.8622187591716}, "2300": {"1400": 236.12056791853482, "1500": 244.20879480119453, "1600": 252.69649570858053, "1700": 261.6898978158076, "1800": 269.83423060081657, "1900": 279.0504105443045, "2000": 288.0726884892737, "2100": 296.735888659208, "2200": 305.3990888291423, "2300": 313.70321122404175, "2400": 323.44364471908045, "2500": 332.4659226640497, "2600": 340.77004505894917, "2700": 349.43324522888344, "2800": 358.0964453988178, "2900": 366.7596455687521, "3000": 375.7819235137212}, "2400": {"1400": 241.03993343651211, "1500": 249.03390240322517, "1600": 257.7146076146924, "1700": 267.31395346729073, "1800": 275.6333366676293, "1900": 285.4357110788615, "2000": 294.6707426055388, "2100": 303.5466963571813, "2200": 312.0635723337889, "2300": 321.65768163550104, "2400": 330.17455761210863, "2500": 339.40958913878586, "2600": 348.2855428904284, "2700": 357.52057441710576, "2800": 366.7556059437828, "2900": 375.6315596954255, "3000": 384.14843567203314}}}};
  const fmtE = v => (v===null || isNaN(v))? '—' : v.toLocaleString('hr-HR', {minimumFractionDigits:2, maximumFractionDigits:2});
  const rate = { sina:3.72, areta:2.19, j1:15.93, vodil:9.56, lajsna:0.80, lamele:2.39 };
  const TBL = document.getElementById('tbl'); const TBODY = TBL.querySelector('tbody'); const MAX_ROWS = 20;

  function mmToM(mm){ return (parseInt(mm,10)||0)/1000; }
  function baseColorAdj(bijelo){ return document.getElementById('box210').checked ? (bijelo * 1.05) : bijelo; }

  function rowCalc(bookKey, Wmm, Hmm){
    const b=BOOKS[bookKey]; if(!b) return null; const bijelo=((b.prices[String(Hmm)]||{})[String(Wmm)])||0;
    const Wm=mmToM(Wmm), Hm=mmToM(Hmm), A=Wm*Hm; const D=rate.sina*Wm + rate.j1*Wm + rate.lajsna*Wm + rate.areta*Hm + rate.vodil*Hm + rate.lamele*A;
    const nasa_boja = baseColorAdj(bijelo) + D;                // Naša — u boji
    const kupac_bijela = bijelo * 2;                           // Kupac — bijela
    const useX2Color = true; // default: Kupac — u boji = 2 × (Naša — u boji)
    const kupac_boja = useX2Color ? (nasa_boja * 2) : (baseColorAdj(bijelo*2) + D);
    return {bijelo, D, nasa_bijela:bijelo, nasa_boja, kupac_bijela, kupac_boja};
  }

  function buildBookSelect(){ const sel=document.createElement('select'); sel.className='book'; Object.keys(BOOKS).forEach(k=>{ const o=document.createElement('option'); o.value=k; o.textContent=BOOKS[k].label; sel.appendChild(o); }); return sel; }
  function buildDimSelect(vals){ const sel=document.createElement('select'); vals.forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; sel.appendChild(o); }); return sel; }

  function addRow(){ if(TBODY.rows.length>=MAX_ROWS) return; const idx=TBODY.rows.length+1; const tr=document.createElement('tr');
    const tdIdx=document.createElement('td'); tdIdx.style.textAlign='center'; tdIdx.textContent=idx;
    const tdBook=document.createElement('td'); const bookSel=buildBookSelect(); tdBook.appendChild(bookSel);
    const tdW=document.createElement('td'); const tdH=document.createElement('td');
    const b0=BOOKS[bookSel.value]; let wSel=buildDimSelect(b0.widths); let hSel=buildDimSelect(b0.heights);
    tdW.appendChild(wSel); tdH.appendChild(hSel);
    const tdQty=document.createElement('td'); const qty=document.createElement('input'); qty.type='number'; qty.min='1'; qty.value='1'; qty.className='qty'; tdQty.appendChild(qty);
    const tdNB=document.createElement('td'); const tdNC=document.createElement('td'); const tdCB=document.createElement('td'); const tdCC=document.createElement('td'); const tdNBp=document.createElement('td'); const tdNCp=document.createElement('td');
    tr.append(tdIdx, tdBook, tdW, tdH, tdQty, tdNB, tdNC, tdCB, tdCC, tdNBp, tdNCp); TBODY.appendChild(tr);

    function refreshDims(){ const b=BOOKS[bookSel.value]; const selWVal=wSel.value; const selHVal=hSel.value; wSel.innerHTML=''; hSel.innerHTML=''; b.widths.forEach(w=>{ const o=document.createElement('option'); o.value=w; o.textContent=w; wSel.appendChild(o); }); b.heights.forEach(h=>{ const o=document.createElement('option'); o.value=h; o.textContent=h; hSel.appendChild(o); }); if(b.widths.includes(parseInt(selWVal,10))) wSel.value=selWVal; else wSel.value=b.widths[Math.min(6,b.widths.length-1)]; if(b.heights.includes(parseInt(selHVal,10))) hSel.value=selHVal; else hSel.value=b.heights[Math.min(8,b.heights.length-1)]; recalcRow(); }

    function recalcRow(){ const b=BOOKS[bookSel.value]; const W=parseInt(wSel.value,10); const H=parseInt(hSel.value,10); if(isNaN(W)||isNaN(H)) return; const res=rowCalc(bookSel.value, W, H); const q=parseInt(qty.value,10)||1; tdNB.textContent=fmtE(res.nasa_bijela*q); tdNC.textContent=fmtE(res.nasa_boja*q); tdCB.textContent=fmtE(res.kupac_bijela*q); tdCC.textContent=fmtE(res.kupac_boja*q); const p=parseFloat(document.getElementById('pct_plus').value)||0; tdNBp.textContent=fmtE(res.nasa_bijela*q*(1+p/100)); tdNCp.textContent=fmtE(res.nasa_boja*q*(1+p/100)); if(tr.classList.contains('sel')){ document.getElementById('kpi_nasa_bijela').textContent=fmtE(res.nasa_bijela); document.getElementById('kpi_nasa_bijela_orig').textContent=`(originalna bijela: ${fmtE(res.bijelo)})`; document.getElementById('kpi_nasa_boja').textContent=fmtE(res.nasa_boja); document.getElementById('kpi_kupac_bijela').textContent=fmtE(res.kupac_bijela); document.getElementById('kpi_kupac_boja').textContent=fmtE(res.kupac_boja); } sumAll(); }

    [bookSel,wSel,hSel,qty].forEach(el=> el.addEventListener('change', recalcRow));
    bookSel.addEventListener('change', refreshDims);
    tr.addEventListener('click', ()=>{ Array.from(TBODY.rows).forEach(r=>r.classList.remove('sel')); tr.classList.add('sel'); recalcRow(); });

    refreshDims();
  }

  function delRow(){ if(TBODY.rows.length){ TBODY.deleteRow(TBODY.rows.length-1); sumAll(); } }
  function sumAll(){ let sNB=0, sNC=0, sCB=0, sCC=0, sNBp=0, sNCp=0; Array.from(TBODY.rows).forEach(tr=>{ const v = (cell)=>{ const t=cell.textContent; const n=parseFloat(t.replace(/\./g,'').replace(',','.')); return isNaN(n)?0:n; }; sNB += v(tr.cells[5]); sNC += v(tr.cells[6]); sCB += v(tr.cells[7]); sCC += v(tr.cells[8]); }); document.getElementById('sum_nasa_bijela').textContent = fmtE(sNB); document.getElementById('sum_nasa_boja').textContent   = fmtE(sNC); document.getElementById('sum_kupac_bijela').textContent= fmtE(sCB); document.getElementById('sum_kupac_boja').textContent  = fmtE(sCC); }

  ['rate_sina','rate_areta','rate_j1','rate_vodil','rate_lajsna','rate_lamele','box210'].forEach(id=>{ const el=document.getElementById(id); if(el) el.addEventListener('change', ()=>{ Array.from(TBODY.rows).forEach(tr=> tr.dispatchEvent(new Event('click'))); }); });

  document.getElementById('add_row').addEventListener('click', addRow);
  document.getElementById('del_row').addEventListener('click', delRow);
  document.getElementById('calc_all').addEventListener('click', ()=>{ Array.from(TBODY.rows).forEach(tr=> tr.dispatchEvent(new Event('click'))); sumAll(); });

  addRow(); addRow();
  const firstRow = TBODY.rows[0]; if(firstRow){ firstRow.classList.add('sel'); firstRow.dispatchEvent(new Event('click')); }

// --- OVERRIDE sumAll with robust version ---
function sumAll(){
  const TBODY = document.getElementById('tbl')?.querySelector('tbody');
  if(!TBODY) return;
  let sNB=0, sNC=0, sCB=0, sCC=0, sNBp=0, sNCp=0;
  const v = (cell)=>{ if(!cell) return 0; const t=cell.textContent||''; const n=parseFloat(t.replace(/\./g,'').replace(',','.')); return isNaN(n)?0:n; };
  Array.from(TBODY.rows).forEach(tr=>{
    if(tr.cells && tr.cells.length>=11){
      sNB  += v(tr.cells[5]);   // Naša — bijela
      sNC  += v(tr.cells[6]);   // Naša — u boji
      sCB  += v(tr.cells[7]);   // Kupac — bijela
      sCC  += v(tr.cells[8]);   // Kupac — u boji
      sNBp += v(tr.cells[9]);   // Naša — bijela (+%)
      sNCp += v(tr.cells[10]);  // Naša — u boji (+%)
    }
  });
  const byId=(id)=>document.getElementById(id);
  if(byId('sum_nasa_bijela')) byId('sum_nasa_bijela').textContent = fmtE(sNB);
  if(byId('sum_nasa_boja'))   byId('sum_nasa_boja').textContent   = fmtE(sNC);
  if(byId('sum_kupac_bijela'))byId('sum_kupac_bijela').textContent= fmtE(sCB);
  if(byId('sum_kupac_boja'))  byId('sum_kupac_boja').textContent  = fmtE(sCC);
  if(byId('sum_nasa_bijela_plus')) byId('sum_nasa_bijela_plus').textContent = fmtE(sNBp);
  if(byId('sum_nasa_boja_plus'))   byId('sum_nasa_boja_plus').textContent   = fmtE(sNCp);
}

// Refresh sums on load and when Uvećanje (%) changes
window.addEventListener('load', sumAll);
const pctEl = document.getElementById('pct_plus');
if(pctEl){ pctEl.addEventListener('input', ()=>{ sumAll(); }); }

</script>
</body>
</html>
